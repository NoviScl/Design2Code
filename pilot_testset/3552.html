<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
 <head>
  <style>
  </style>
  <title>
   cache: move open to thread pool
  </title>
  <meta content="index,nofollow" name="robots">
  <style type="text/css">
   pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
  </style>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
 </head>
 <body bgcolor="#ffffff">
  <h1>
   cache: move open to thread pool
  </h1>
  <b>
   Eran Kornblau
  </b>
  <a title="cache: move open to thread pool">
   eran.kornblau at kaltura.com
  </a>
  <br>
  <i>
   Tue Aug 28 09:15:32 UTC 2018
  </i>
  <p>
  </p>
  <ul>
   <li>
    Previous message (by thread):
    <a>
     cache: move open to thread pool
    </a>
   </li>
   <li>
    Next message (by thread):
    <a>
     cache: move open to thread pool
    </a>
   </li>
   <li>
    <b>
     Messages sorted by:
    </b>
    <a>
     [ date ]
    </a>
    <a>
     [ thread ]
    </a>
    <a>
     [ subject ]
    </a>
    <a>
     [ author ]
    </a>
   </li>
  </ul>
  <hr>
  <!--beginarticle-->
  <pre>Hi,

&gt;<i> Hi Eran,
</i>&gt;<i> 
</i>&gt;<i>Happy to see that we are not the only place where we find open to be a problem. I took a look at your module and while the approach is sound, I decided the complexity doesn't seem to be worth it.</i>&gt;<i> 
</i>&gt;<i> - Ka-Hing
</i>&gt;<i> 
</i>I don't have numbers that show the improvement we got from moving open to a thread pool, 
but what I can say is that on our environment, open can sometimes take an unreasonable 
time to complete - several seconds.
I noticed it several years ago, after I added a feature of 'performance counters' to my module 
(posted it here - <a>https://forum.nginx.org/read.php?2,255847,258854#msg-258854</a>).
This is the reason I decided to implement the async open - in order to avoid having all 
worker active requests hang for so long.
In my case, I was already using open file cache, and while I got a fairly good hit ratio, 
these extreme cases of worker hanging for few seconds wasn't something I wanted to accept.
Also, in my setup, I'm not using proxy_cache - my servers serve as origin servers behind a CDN, 
so a solution that is limited to file cache is not something I could use.

Eran
</pre>
  <!--endarticle-->
  <hr>
  <p>
  </p>
  <ul>
   <!--threads-->
   <li>
    Previous message (by thread):
    <a>
     cache: move open to thread pool
    </a>
   </li>
   <li>
    Next message (by thread):
    <a>
     cache: move open to thread pool
    </a>
   </li>
   <li>
    <b>
     Messages sorted by:
    </b>
    <a>
     [ date ]
    </a>
    <a>
     [ thread ]
    </a>
    <a>
     [ subject ]
    </a>
    <a>
     [ author ]
    </a>
   </li>
  </ul>
  <hr>
  <a>
   More information about the nginx-devel
mailing list
  </a>
  <br>
 </body>
</html>
