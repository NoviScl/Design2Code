<html><head>
<style></style>
  <title>AT90LS8535 Digital Answering Machine </title>
</head>
<body link="#0000ff" vlink="#800080">
<p align="Center">
<font size="7"> <b> AT90LS8535 Digital Answering Machine</b></font>
</p><p align="Center">
<font size="5"> Final project –
<a >EE476
Microcontroller Design Spring 1999 </a><br>
<a >Brian Glassmeyer</a> and
<a >Eric Melin </a></font>
<font size="4"> </font>
</p><p align="Left">
<b>Introduction</b>
</p><p align="Left">
We were given the task of designing something cool using the AT90LS85835
8-bit microcontroller for our final project in EE476. We decided that an
answering machine was interesting because it involved interfacing many analog
parts, a reasonable amount of coding, and would leave us with a finished
product that actually does something. The answering machine is one of few
everyday microcontroller utilities that can be implemented fairly easily
and we are really happy with our final product. &nbsp;We also realize that
we share a common fear of analog circuitry and felt this would force us to
gain working knowledge of this material.
</p><p>
</p><p>
<b>High Level Design -</b>
</p><p>
Our answering machine is designed to:
</p><ul>
  <li>
    Record – on phone pickup start recording
  </li><li>
    Playback – on Button 7 push
  </li><li>
    Stop Playback – on Button 6 push
  </li><li>
    Skip Messages – on Button 5 push
  </li><li>
    Delete Messages – on Button 4 push
</li></ul>
<p>
<b>Program/Hardware Design - </b>
</p><p>
The main tasks in this design were to record voice and play it back, address
the SRAM, and store/read from the SRAM. &nbsp;We achieved recording by using
the ADC provided with the AVR microcontroller. We sampled voice at a rate
of 6000 samples / second giving us just under voice quality recording.
</p><p>
To make it more realistic, we used a regular telephone as our microphone
for input into the ADC. &nbsp;We did not use external phone lines because
we did not want to deal with ringing circuitry and there is no phone line
access in the EE lab. &nbsp;Through testing, we discovered that the phone
operates on a supply from 6V-18V through its red wire. &nbsp;Voice input
results in a current modulation in the green wire of the phone cord. &nbsp;By
using a 7V supply, we assured that the peak voltage across a 330Ohm resistor
on the green wire would be less than our ARef of 4.096V. &nbsp;A lot of
debouncing of the hangup receiver is required in software.
</p><p>
Due to budget restraints, we ordered a 128kx8 SRAM from digikey. &nbsp;With
the above sampling rate, this allows us to record and save 21.8 seconds (128ksam
/&nbsp;6000sam/sec = 21.8sec).
</p><p>
We needed to order an external counter to address this much memory. &nbsp;To
sddress 128k memory locations, we need 17 bits. &nbsp;Our external counter
provided the 12 lower bits (only requiring two inputs itself) while we drew
the higher 5 bits off the microcontroller. &nbsp;These higher 5 bits give
us instant access to 32 different locations. &nbsp;The lower 12 bits can
only be incremented or cleared. &nbsp;This means we may waste a maximum of
4096 address bits at the end of a message. &nbsp;This is merely .68 seconds
and is hardly an issue.
</p><p>
The 8 bit samples are sent to a DAC through a bus connected also to the
microcontroller and the SRAM. &nbsp;The DAC sends its output through an opamp
to a simple external speaker. &nbsp;The use of one data bus allows messages
to be heard while first being recorded and while being played back. &nbsp;During
playback, however, you must remember to set the microcontroller to Hi-Z in
order to prevent multiple drivers to the single bus.
</p><p>
</p><p>
<b>Testing Methods -</b>
</p><p>
Realizing the amount of external hardware that would be interacting, we
approached our testing in several stages. &nbsp;We wrote individual test
codes for every external component (these codes are linked below). &nbsp;Only
after we successfully operated and controlled each of these seperately did
we combine them into one project. &nbsp;We never fully debugged this code,
but only used it as a means to observe the counter and ram were
working.&nbsp;&nbsp;We then used simple tests again to verify and correct
any wiring issues.
</p><p>
-Our first full test was to input voice and directly output it through the
DAC (the SRAM was bypassed on the bus).<br>
-The second test was to record the voice into the SRAM and display the bits
on the LEDs.<br>
-We automatically started and stopped recording using the analog comparator
on the green wire of the phone cord.<br>
-Combining these we eventually built up our record and play functions.<br>
-The delete function was then added.<br>
-Implemented skip meant we needed memory management using dynamic tables
and flags.<br>
-Fool-proofing our design involved finding remote errors that could occur
in extreme situations.
</p><p>
</p><p>
<b>Results of the Design -</b>
</p><p>
The answering machine can record up to our full 21 seconds and play it back
in clearly understandable output. &nbsp;We can record anywhere from one 21.8
second message to thirtytwo .68 second messages. &nbsp;This leaves an incredible
amount of flexibilty for an answering machine where message lengths vary
unpredictably.
</p><p>
Multiple messages are recorded one after another. &nbsp;Using the play button
will begin with the first message and play until the end of the last message.
&nbsp;The delete button will erase all of the messages at once (just like
a cassette tape answering machine). &nbsp;The stop button will cease any
playing and return to the beginning of the message queue. &nbsp;The skip
button will cease the current message and begin playing the next message
in the queue.
</p><p>
Cool Extra Features:
</p><ul>
  <li>
    Recording will stop automatically if the end of the SRAM is reached preventing
    circular overwriting.
  </li><li>
    Play will stop and end of last message preventing extra garbage from being
    played.
  </li><li>
    Skip will not play beyond last message.
  </li><li>
    Play and skip will not work if there are no messages present.
  </li><li>
    Picking up the phone during play will cease play and start recording at end
    of message queue.
</li></ul>
<p>
</p><p>
<b>Software Designed -</b>
</p><ul>
  <li>
    <a >Digital Answering Machine </a>
  </li><li>
    <a >Include file</a>
  </li><li>
    <a >Test DAC conversion </a>
  </li><li>
    <a >Test Counter </a>
  </li><li>
    <a >Test RAM</a>
</li></ul>
<p>
</p><p>
<b>Answering Machine Schematic (and pics) -</b>
</p><ul>
  <li>
    <a >Schematic</a>
  </li><li>
    <a >Full view of layout </a>
  </li><li>
    <a >Close-up of surface mount contraption </a>
</li></ul>
<p>
<a ></a>
</p><p>
<b>Spec Sheets and References</b>
</p><ul>
  <li>
    <a >ram
    spec </a>
  </li><li>
    <a >counter
    spec </a>
  </li><li>
    <a >8535
    spec </a>
  </li><li>
    <a ></a><a >howstuffworks.com</a>
    
</li></ul>
<p>
</p><p>
<b>What We Would Do Differently</b>
</p><p>
We would order a counter and RAM that was not surface mount. &nbsp;In order
to make these chips usable we made an interesting contraption. &nbsp;We placed
the surface mount chip ontop of a wire wrap socket. &nbsp;Soldering short
leads to its pins, we folded the wires around the sides of the socket and
wire wrapped them to the posts underneath. &nbsp;This results in a DIP-like
package shown above in the schematic and pics section.
</p><p>
We would implement the debouncing of the input capture from the beginning
to facillitate testing. &nbsp;Getting a clean pickup and hangup of the phone
caused many problems.
</p><p>
</p><p>
<b>Extensions</b>
</p><dl>
  <dd>
    We thought of many extensions to this project if we had more time.
</dd></dl>
<ol>
  <li>
    Use serial interface with computer for larger storage capabilities (but we
    prefer the stand-alone approach not dependant on the computer).
  </li><li>
    We would have liked to implement more powerful memory management.
    &nbsp;Currently, our delete is an all-or-nothing format. &nbsp;We would like
    to be able to individually delete one message at a time. &nbsp;In order to
    accomplish this, we would need to shift all messages after the deleted message
    forward to fill the gap. &nbsp;This would be more effective for our short
    memory than dynamic links.
  </li><li>
    Interface with the phone network w/ ringer circuitry to answer real phone
    company calls. &nbsp;An intro message would then be appropriate.
  </li><li>
    Adding beeps between messages for distiction.
</li></ol>
<h4>
  Email
</h4>
<p>
<a >edm5@cornell.edu</a> or
<a >bpg3@cornell.edu</a>
</p><p>
</p><p>

</p></body></html>