<html><head>
<style></style>

<title>Using and Porting GNU Fortran - Installing GNU Fortran</title>
</head>
<body>
Go to the <a >first</a>, <a >previous</a>, <a >next</a>, <a >last</a> section, <a >table of contents</a>.
<hr>

<h1><a name="SEC528" >Installing GNU Fortran</a></h1>
<p>
<a name="IDX1811"></a>

</p>
<p>
The following information describes how to install <code>g77</code>.

</p>

<p>
Note that, for users of the GCC-2.95 version of <code>g77</code>,
much of the information is obsolete,
and is superceded by the
GCC installation procedures.
Such information is accordingly omitted and flagged as such.

</p>

<p>
The following information was last updated on 1999-07-17:

</p>

<h2><a name="SEC529" >Prerequisites</a></h2>
<p>
<a name="IDX1812"></a>

</p>
<p>
For users of the GCC-2.95 version of <code>g77</code>,
this information is superceded by the
GCC installation instructions.

</p>

<h2><a name="SEC530" >Problems Installing</a></h2>
<p>
<a name="IDX1813"></a>
<a name="IDX1814"></a>

</p>
<p>
This is a list of problems (and some apparent problems which don't
really mean anything is wrong) that show up when configuring,
building, installing, or porting GNU Fortran.

</p>
<p>
See section `Installation Problems' in <cite>Using and Porting GNU CC</cite>,
for more information on installation problems that can afflict
either <code>gcc</code> or <code>g77</code>.

</p>

<h3><a name="SEC531" >General Problems</a></h3>

<p>
These problems can occur on most or all systems.

</p>

<h4><a name="SEC532" >GNU C Required</a></h4>
<p>
<a name="IDX1815"></a>
<a name="IDX1816"></a>

</p>
<p>
Compiling <code>g77</code> requires GNU C, not just ANSI C.
Fixing this wouldn't
be very hard (just tedious), but the code using GNU extensions to
the C language is expected to be rewritten for 0.6 anyway,
so there are no plans for an interim fix.

</p>
<p>
This requirement does not mean you must already have <code>gcc</code>
installed to build <code>g77</code>.
As long as you have a working C compiler, you can use a
"bootstrap" build to automate the process of first building
<code>gcc</code> using the working C compiler you have, then building
<code>g77</code> and rebuilding <code>gcc</code> using that just-built <code>gcc</code>,
and so on.

</p>

<h4><a name="SEC533" >Patching GNU CC</a></h4>
<p>
<a name="IDX1817"></a>
<a name="IDX1818"></a>

</p>
<p>
<code>g77</code> no longer requires application of a patch file
to the <code>gcc</code> compiler tree.
In fact, no such patch file is distributed with <code>g77</code>.
This is as of version 0.5.23
and <code>egcs</code> version 1.0.

</p>

<h4><a name="SEC534" >Building GNU CC Necessary</a></h4>
<p>
<a name="IDX1819"></a>
<a name="IDX1820"></a>

</p>
<p>
It should be possible to build the runtime without building <code>cc1</code>
and other non-Fortran items, but, for now, an easy way to do that
is not yet established.

</p>

<h4><a name="SEC535" >Missing strtoul or bsearch</a></h4>
<p>
<a name="IDX1821"></a>
<a name="IDX1822"></a>
<a name="IDX1823"></a>
<a name="IDX1824"></a>
<a name="IDX1825"></a>
<a name="IDX1826"></a>
<a name="IDX1827"></a>
<a name="IDX1828"></a>
<a name="IDX1829"></a>
<a name="IDX1830"></a>
<a name="IDX1831"></a>
<a name="IDX1832"></a>

</p>
<p>
This information does not apply to
the GCC-2.95 version of <code>g77</code>,

</p>

<h4><a name="SEC536" >Cleanup Kills Stage Directories</a></h4>
<p>
<a name="IDX1833"></a>
<a name="IDX1834"></a>

</p>
<p>
It'd be helpful if <code>g77</code>'s <tt>`Makefile.in'</tt> or <tt>`Make-lang.in'</tt>
would create the various <tt>`stage<var>n</var>'</tt> directories and their
subdirectories, so developers and expert installers wouldn't have to
reconfigure after cleaning up.

</p>
<p>
That help has arrived as of version 0.5.23 of <code>g77</code>
and version 1.1 of <code>egcs</code>.
Configuration itself no longer creates any particular directories
that are unique to <code>g77</code>.
The build procedures in <tt>`Make-lang.in'</tt> take care of
that, on demand.

</p>

<h4><a name="SEC537" >LANGUAGES Macro Ignored</a></h4>
<p>
<a name="IDX1835"></a>
<a name="IDX1836"></a>

</p>
<p>
Prior to version 0.5.23 of <code>g77</code>
and version 1.1 of <code>egcs</code>,
<code>g77</code> would sometimes ignore
the absence of <code>f77</code> and <code>F77</code> in the
<code>LANGUAGES</code> macro definition used for the
<code>make</code> command being processed.

</p>
<p>
As of <code>g77</code> version 0.5.23
and <code>egcs</code> version 1.1,
<code>g77</code> now obeys this macro
in all relevant situations.

</p>
<p>
However, in versions of <code>gcc</code> through 2.8.1,
non-<code>g77</code> portions of <code>gcc</code>,
such as <code>g++</code>,
are known to go ahead and perform various
language-specific activities when their
respective language strings do not appear
in the <code>LANGUAGES</code> macro in effect
during that invocation of <code>make</code>.

</p>
<p>
It is expected that these remaining problems will
be fixed in a future version of <code>gcc</code>.

</p>

<h3><a name="SEC538" >System-specific Problems</a></h3>

<p>
<a name="IDX1837"></a>
A linker bug on some versions of AIX 4.1 might prevent building
when <code>g77</code> is built within <code>gcc</code>.
It might also occur when building within <code>egcs</code>.
See section <a ><code>LINKFAIL</code></a>.

</p>

<h3><a name="SEC539" >Cross-compiler Problems</a></h3>
<p>
<a name="IDX1838"></a>

</p>
<p>
<code>g77</code> has been in alpha testing since September of
1992, and in public beta testing since February of 1995.
Alpha testing was done by a small number of people worldwide on a fairly
wide variety of machines, involving self-compilation in most or
all cases.
Beta testing has been done primarily via self-compilation,
but in more and more cases, cross-compilation (and "criss-cross
compilation", where a version of a compiler is built on one machine
to run on a second and generate code that runs on a third) has
been tried and has succeeded, to varying extents.

</p>
<p>
Generally, <code>g77</code> can be ported to any configuration to which
<code>gcc</code>, <code>f2c</code>, and <code>libf2c</code> can be ported and made
to work together, aside from the known problems described in this
manual.
If you want to port <code>g77</code> to a particular configuration,
you should first make sure <code>gcc</code> and <code>libf2c</code> can be
ported to that configuration before focusing on <code>g77</code>, because
<code>g77</code> is so dependent on them.

</p>
<p>
Even for cases where <code>gcc</code> and <code>libf2c</code> work,
you might run into problems with cross-compilation on certain machines,
for several reasons.

</p>

<ul>
<li>

There is one known bug
(a design bug to be fixed in 0.6) that prevents configuration of
<code>g77</code> as a cross-compiler in some cases,
though there are assumptions made during
configuration that probably make doing non-self-hosting builds
a hassle, requiring manual intervention.

</li><li>

<code>gcc</code> might still have some trouble being configured
for certain combinations of machines.
For example, it might not know how to handle floating-point
constants.

</li><li>

Improvements to the way <code>libg2c</code> is built could make
building <code>g77</code> as a cross-compiler easier--for example,
passing and using <samp>`$(LD)'</samp> and <samp>`$(AR)'</samp> in the appropriate
ways.
(This is improved in the <code>egcs</code> version of <code>g77</code>,
especially as of version 1.1.)

</li><li>

There are still some challenges putting together the right
run-time libraries (needed by <code>libg2c</code>) for a target
system, depending on the systems involved in the configuration.
(This is a general problem with cross-compilation, and with
<code>gcc</code> in particular.)
</li></ul>

<h2><a name="SEC540" >Changing Settings Before Building</a></h2>

<p>
Here are some internal <code>g77</code> settings that can be changed
by editing source files in <tt>`egcs/gcc/f/'</tt> before building.

</p>
<p>
This information, and perhaps even these settings, represent
stop-gap solutions to problems people doing various ports
of <code>g77</code> have encountered.
As such, none of the following information is expected to
be pertinent in future versions of <code>g77</code>.

</p>

<h3><a name="SEC541" >Larger File Unit Numbers</a></h3>
<p>
<a name="IDX1839"></a>
<a name="IDX1840"></a>
<a name="IDX1841"></a>
<a name="IDX1842"></a>
<a name="IDX1843"></a>

</p>
<p>
As distributed, whether as part of <code>f2c</code> or <code>g77</code>,
<code>libf2c</code> accepts file unit numbers only in the range
0 through 99.
For example, a statement such as <samp>`WRITE (UNIT=100)'</samp> causes
a run-time crash in <code>libf2c</code>, because the unit number,
100, is out of range.

</p>
<p>
If you know that Fortran programs at your installation require
the use of unit numbers higher than 99, you can change the
value of the <code>MXUNIT</code> macro, which represents the maximum unit
number, to an appropriately higher value.

</p>
<p>
To do this, edit the file <tt>`egcs/libf2c/libI77/fio.h'</tt> in your
<code>g77</code> source tree, changing the following line:

</p>

<pre>#define MXUNIT 100
</pre>

<p>
Change the line so that the value of <code>MXUNIT</code> is defined to be
at least one <em>greater</em> than the maximum unit number used by
the Fortran programs on your system.

</p>
<p>
(For example, a program that does <samp>`WRITE (UNIT=255)'</samp> would require
<code>MXUNIT</code> set to at least 256 to avoid crashing.)

</p>
<p>
Then build or rebuild <code>g77</code> as appropriate.

</p>
<p>
<em>Note:</em> Changing this macro has <em>no</em> effect on other limits
your system might place on the number of files open at the same time.
That is, the macro might allow a program to do <samp>`WRITE (UNIT=100)'</samp>,
but the library and operating system underlying <code>libf2c</code> might
disallow it if many other files have already been opened (via <code>OPEN</code> or
implicitly via <code>READ</code>, <code>WRITE</code>, and so on).
Information on how to increase these other limits should be found
in your system's documentation.

</p>

<h3><a name="SEC542" >Always Flush Output</a></h3>
<p>
<a name="IDX1844"></a>
<a name="IDX1845"></a>
<a name="IDX1846"></a>
<a name="IDX1847"></a>
<a name="IDX1848"></a>
<a name="IDX1849"></a>
<a name="IDX1850"></a>
<a name="IDX1851"></a>
<a name="IDX1852"></a>
<a name="IDX1853"></a>

</p>
<p>
Some Fortran programs require output
(writes) to be flushed to the operating system (under UNIX,
via the <code>fflush()</code> library call) so that errors,
such as disk full, are immediately flagged via the relevant
<code>ERR=</code> and <code>IOSTAT=</code> mechanism, instead of such
errors being flagged later as subsequent writes occur, forcing
the previously written data to disk, or when the file is
closed.

</p>
<p>
Essentially, the difference can be viewed as synchronous error
reporting (immediate flagging of errors during writes) versus
asynchronous, or, more precisely, buffered error reporting
(detection of errors might be delayed).

</p>
<p>
<code>libg2c</code> supports flagging write errors immediately when
it is built with the <code>ALWAYS_FLUSH</code> macro defined.
This results in a <code>libg2c</code> that runs slower, sometimes
quite a bit slower, under certain circumstances--for example,
accessing files via the networked file system NFS--but the
effect can be more reliable, robust file I/O.

</p>
<p>
If you know that Fortran programs requiring this level of precision
of error reporting are to be compiled using the
version of <code>g77</code> you are building, you might wish to
modify the <code>g77</code> source tree so that the version of
<code>libg2c</code> is built with the <code>ALWAYS_FLUSH</code> macro
defined, enabling this behavior.

</p>
<p>
To do this, find this line in <tt>`egcs/libf2c/f2c.h'</tt> in
your <code>g77</code> source tree:

</p>

<pre>
</pre>

<p>
Remove the leading <samp>`'</samp>.

</p>
<p>
Then build or rebuild <code>g77</code> as appropriate.

</p>

<h3><a name="SEC543" >Maximum Stackable Size</a></h3>
<p>
<a name="IDX1854"></a>
<a name="IDX1855"></a>
<a name="IDX1856"></a>
<a name="IDX1857"></a>
<a name="IDX1858"></a>
<code>g77</code>, on most machines, puts many variables and arrays on the stack
where possible, and can be configured (by changing
<code>FFECOM_sizeMAXSTACKITEM</code> in <tt>`egcs/gcc/f/com.c'</tt>) to force
smaller-sized entities into static storage (saving
on stack space) or permit larger-sized entities to be put on the
stack (which can improve run-time performance, as it presents
more opportunities for the GBE to optimize the generated code).

</p>
<p>
<em>Note:</em> Putting more variables and arrays on the stack
might cause problems due to system-dependent limits on stack size.
Also, the value of <code>FFECOM_sizeMAXSTACKITEM</code> has no
effect on automatic variables and arrays.
See section <a >Bugs Not In GNU Fortran</a>, for more information.

</p>

<h3><a name="SEC544" >Floating-point Bit Patterns</a></h3>

<p>
<a name="IDX1859"></a>
<a name="IDX1860"></a>
<a name="IDX1861"></a>
The <code>g77</code> build will crash if an attempt is made to build
it as a cross-compiler
for a target when <code>g77</code> cannot reliably determine the bit pattern of
floating-point constants for the target.
Planned improvements for version 0.6 of <code>g77</code>
will give it the capabilities it needs to not have to crash the build
but rather generate correct code for the target.
(Currently, <code>g77</code>
would generate bad code under such circumstances if it didn't crash
during the build, e.g. when compiling a source file that does
something like <samp>`EQUIVALENCE (I,R)'</samp> and <samp>`DATA R/9.43578/'</samp>.)

</p>

<h3><a name="SEC545" >Initialization of Large Aggregate Areas</a></h3>

<p>
<a name="IDX1862"></a>
<a name="IDX1863"></a>
<a name="IDX1864"></a>
<a name="IDX1865"></a>
<a name="IDX1866"></a>
A warning message is issued when <code>g77</code> sees code that provides
initial values (e.g. via <code>DATA</code>) to an aggregate area (<code>COMMON</code>
or <code>EQUIVALENCE</code>, or even a large enough array or <code>CHARACTER</code>
variable)
that is large enough to increase <code>g77</code>'s compile time by roughly
a factor of 10.

</p>
<p>
This size currently is quite small, since <code>g77</code>
currently has a known bug requiring too much memory
and time to handle such cases.
In <tt>`egcs/gcc/f/data.c'</tt>, the macro
<code>FFEDATA_sizeTOO_BIG_INIT_</code> is defined
to the minimum size for the warning to appear.
The size is specified in storage units,
which can be bytes, words, or whatever, on a case-by-case basis.

</p>
<p>
After changing this macro definition, you must
(of course) rebuild and reinstall <code>g77</code> for
the change to take effect.

</p>
<p>
Note that, as of version 0.5.18, improvements have
reduced the scope of the problem for <em>sparse</em>
initialization of large arrays, especially those
with large, contiguous uninitialized areas.
However, the warning is issued at a point prior to
when <code>g77</code> knows whether the initialization is sparse,
and delaying the warning could mean it is produced
too late to be helpful.

</p>
<p>
Therefore, the macro definition should not be adjusted to
reflect sparse cases.
Instead, adjust it to generate the warning when densely
initialized arrays begin to cause responses noticeably slower
than linear performance would suggest.

</p>

<h3><a name="SEC546" >Alpha Problems Fixed</a></h3>

<p>
<a name="IDX1867"></a>
<a name="IDX1868"></a>
<code>g77</code> used to warn when it was used to compile Fortran code
for a target configuration that is not basically a 32-bit
machine (such as an Alpha, which is a 64-bit machine, especially
if it has a 64-bit operating system running on it).
That was because <code>g77</code> was known to not work
properly on such configurations.

</p>
<p>
As of version 0.5.20, <code>g77</code> is believed to work well
enough on such systems.
So, the warning is no longer needed or provided.

</p>
<p>
However, support for 64-bit systems, especially in
areas such as cross-compilation and handling of
intrinsics, is still incomplete.
The symptoms
are believed to be compile-time diagnostics rather
than the generation of bad code.
It is hoped that version 0.6 will completely support 64-bit
systems.

</p>

<h2><a name="SEC547" >Quick Start</a></h2>
<p>
<a name="IDX1869"></a>

</p>
<p>
For users of the GCC-2.95 version of <code>g77</code>,
this information is superceded by the
GCC installation instructions.

</p>

<h2><a name="SEC548" >Complete Installation</a></h2>

<p>
For users of the GCC-2.95 version of <code>g77</code>,
this information is superceded by the
GCC installation instructions.

</p>

<h2><a name="SEC549" >Distributing Binaries</a></h2>
<p>
<a name="IDX1870"></a>
<a name="IDX1871"></a>

</p>
<p>
For users of the GCC-2.95 version of <code>g77</code>,
this information is superceded by the
GCC installation instructions.

</p>

<hr>
Go to the <a >first</a>, <a >previous</a>, <a >next</a>, <a >last</a> section, <a >table of contents</a>.

</body></html>