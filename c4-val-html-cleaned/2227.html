<!DOCTYPE html PUBLIC "-//W3C//DTD HTML//EN">
<html>
 <head>
  <style>
  </style>
  <title>
   Re: Using Replication Slave For Authentication
  </title>
 </head>
 <body bgcolor="white">
  <!--X-Body-Begin-->
  <!--X-User-Header-->
  <!--X-User-Header-End-->
  <!--X-TopPNI-->
  <hr>
  [
  <a>
   Date Prev
  </a>
  ][
  <a>
   Date Next
  </a>
  ]
  <a>
   [Chronological]
  </a>
  <a>
   [Thread]
  </a>
  <a>
   [Top]
  </a>
  <!--X-TopPNI-End-->
  <!--X-MsgBody-->
  <!--X-Subject-Header-Begin-->
  <h1>
   Re: Using Replication Slave For Authentication
  </h1>
  <hr>
  <!--X-Subject-Header-End-->
  <!--X-Head-of-Message-->
  <ul>
   <li>
    <strong>
     To
    </strong>
    :
    <strong>
     <a>
      openldap-technical@openldap.org
     </a>
    </strong>
   </li>
   <li>
    <strong>
     Subject
    </strong>
    :
    <strong>
     Re: Using Replication Slave For Authentication
    </strong>
   </li>
   <li>
    <strong>
     From
    </strong>
    :
    <strong>
     Ariel &lt;
     <a>
      ariel@bidcactus.com
     </a>
     &gt;
    </strong>
   </li>
   <li>
    Date: Wed, 21 Apr 2010 10:23:56 -0400
   </li>
   <li>
    In-reply-to: &lt;
    <a>
    </a>
    <a>
     4BCE0E8E.4070502@mail.usask.ca
    </a>
    &gt;
   </li>
   <li>
    References: &lt;
    <a>
    </a>
    <a>
     29DBDF7B-FC68-4022-A013-84EF445303F7@bidcactus.com
    </a>
    &gt;	&lt;
    <a>
    </a>
    <a>
     4BCDD467.5020708@mail.usask.ca
    </a>
    &gt;	&lt;
    <a>
     9F6F4B4C-4E7A-4DA4-A2AA-7E71DA762D4A@bidcactus.com
    </a>
    &gt;	&lt;
    <a>
     4BCDE97C.6050004@mail.usask.ca
    </a>
    &gt;	&lt;
    <a>
    </a>
    <a>
     3A9DAB1F-864B-4587-B2C3-78A883E80C94@bidcactus.com
    </a>
    &gt;	&lt;
    <a>
    </a>
    <a>
     4BCE0E8E.4070502@mail.usask.ca
    </a>
    &gt;
   </li>
  </ul>
  <!--X-Head-of-Message-End-->
  <!--X-Head-Body-Sep-Begin-->
  <hr>
  <!--X-Head-Body-Sep-End-->
  <!--X-Body-of-Message-->
  <pre>My backend is hdb.  Also, I'm very sure the rootdn and rootpw are correct, as I have been using it for most of my testing.  As for being denied read for cn=config, I'm pretty sure that is because it doesn't exist.  

After running your command this is the result:

No such object (32)

It does not exist on either the master or slave server.  I am using the slapd.conf configuration method, is there anything else I could show you?

-a


On Apr 20, 2010, at 4:29 PM, Sergiy Stepanenko wrote:

&gt; I guess your backend is bdb or hdb.
&gt; Run
&gt; 
&gt; ldapsearch -LL -H &lt;your_ldap_host&gt; -x -D &lt;rootdn&gt; -w &lt;rootpw&gt; -b "cn=config" * +
&gt; 
&gt; and see what it produces. But before you do that open slapd.conf if you use flat file configuration and check what exactly configured for rootdn and rootpw because if "backend default search access denied to "cn=admin,dc=domain,dc=com" then you have a problem in config.
&gt; 
&gt; It is much easier to talk if I know what is configured actually, because snippets of log and config file dont tell whole story.
&gt; 
&gt; Cheers
&gt; 
&gt; 
&gt;&gt; 
&gt;&gt; Putting loglevel to -1 (everything) and logging in with ApacheDS as cn=admin,dc=domain,dc=com (which is supposed to supersede any ACL rules and have read/write to everything I believe) I find a whole lot of "access granted" lines and then towards the end":
&gt;&gt; 
&gt;&gt; =&gt;  access_allowed: search access to "cn=config" "entry" requested
&gt;&gt; =&gt;  slap_access_allowed: backend default search access denied to "cn=admin,dc=domain,dc=com"
&gt;&gt; =&gt;  access_allowed: no more rules
&gt;&gt; send_ldap_result: conn=0 op=8 p=3
&gt;&gt; send_ldap_result: err=32 matched="" text=""
&gt;&gt; 
&gt;&gt; Error 32 means object doesn't exist (I think).  Which would be true, our LDAP tree has no cn=config.  We get the same error on the primary server, so I suppose it is ApacheDS trying to look for what would be in the Apache LDAP implementation.  But that's the only error I can find, everything else is miles and miles of "search access granted".
&gt;&gt; 
&gt;&gt; I tried to get it to list DN="dc=domain,dc=com" by hand from ApacheDS, and it would not return anything (it says "No base DN returned from server.") although in the logs it shows:
&gt;&gt; 
&gt;&gt; conn=6 op=3 SRCH base="dc=domain,dc=com" scope=0 deref=3 filter="(objectClass=*)"
&gt;&gt; conn=6 op=3 SRCH attr=hasSubordinates objectClass
&gt;&gt; =&gt;  hdb_search
&gt;&gt; bdb_dn2entry("dc=domain,dc=com")
&gt;&gt; =&gt;  access_allowed: search access to "dc=domain,dc=com" "entry" requested
&gt;&gt; &lt;= root access granted
&gt;&gt; access_allowed: search access granted by manage(=mwrscxd)
&gt;&gt; base_candidates: base: "dc=domains,dc=com" (0x00000001)
&gt;&gt; send_ldap_result: conn=6 op=3 p=3
&gt;&gt; send_ldap_result: err=0 matched="" text=""
&gt;&gt; send_ldap_response: msgid=4 tag=101 err=0
&gt;&gt; 
&gt;&gt; But when I run the ldapsearch command (as any user) from other computers on the network it returns the DN's information... So I am thoroughly confused...  I am pretty sure it is not logging in as anonymous, but I have no idea why only the ldapsearch command is the only thing that can authenticate and retrieve information.  It is the same version of openldap as the primary server, it has the same exact config, it has all the same schema loaded, it has the exact full ldap tree.  I'm going to explode!@$#@
&gt;&gt; 
&gt;&gt; -a
&gt;&gt; 
&gt; 
&gt; 
&gt; -- 
&gt; Sergiy Stepanenko
&gt; Systems Administrator
&gt; Information Technology Services
&gt; University of Saskatchewan
&gt; -----------------------------------
&gt; phone:    (306) 966-2762
&gt; email:sergiy.stepanenko@usask.ca


</pre>
  <!--X-Body-of-Message-End-->
  <!--X-MsgBody-End-->
  <!--X-Follow-Ups-->
  <hr>
  <!--X-Follow-Ups-End-->
  <!--X-References-->
  <ul>
   <li>
    <strong>
     References
    </strong>
    :
    <ul>
     <li>
      <strong>
       <a name="00170">
        Using Replication Slave For Authentication
       </a>
      </strong>
      <ul>
       <li>
        <em>
         From:
        </em>
        Ariel &lt;ariel@bidcactus.com&gt;
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <a name="00175">
        Re: Using Replication Slave For Authentication
       </a>
      </strong>
      <ul>
       <li>
        <em>
         From:
        </em>
        Sergiy Stepanenko &lt;ses863@mail.usask.ca&gt;
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <a name="00176">
        Re: Using Replication Slave For Authentication
       </a>
      </strong>
      <ul>
       <li>
        <em>
         From:
        </em>
        Ariel &lt;ariel@bidcactus.com&gt;
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <a name="00177">
        Re: Using Replication Slave For Authentication
       </a>
      </strong>
      <ul>
       <li>
        <em>
         From:
        </em>
        Sergiy Stepanenko &lt;ses863@mail.usask.ca&gt;
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
  <!--X-References-End-->
  <!--X-BotPNI-->
  <ul>
   <li>
    Prev by Date:
    <strong>
     <a>
      RE: RPM spec file
     </a>
    </strong>
   </li>
   <li>
    Next by Date:
    <strong>
     <a>
      Is this possible? Suggestions?
     </a>
    </strong>
   </li>
   <li>
    Index(es):
    <ul>
     <li>
      <a>
       <strong>
        Chronological
       </strong>
      </a>
     </li>
     <li>
      <a>
       <strong>
        Thread
       </strong>
      </a>
     </li>
     <!--X-BotPNI-End-->
     <!--X-User-Footer-->
     <!--X-User-Footer-End-->
    </ul>
   </li>
  </ul>
 </body>
</html>
