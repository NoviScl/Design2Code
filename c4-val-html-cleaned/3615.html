<!DOCTYPE html>
<html>
 <head>
  <style>
   body{background-color:#FFF;font-family:Verdana,Helvetica,Arial;font-size:14px;margin:0}a{color:#1B97F2;text-decoration:none}a:hover{text-decoration:underline}a img{border:none}h1{font-size:24px}h2{font-size:18px}h3{font-size:14px}h4{font-size:12px}.clear{clear:both}ul{margin:4px 0;padding-left:17px}ul.horizontal{list-style:none;margin:0;padding:0}ul.horizontal li{margin:0;padding:0;float:left}#flash_notice,#flash_alert{padding:10px 0;text-align:center;color:#FFF}#flash_notice{background-color:#267923}#flash_alert{background-color:#871F22}#flash_notice a,#flash_alert a{color:#FFF}.field{margin:10px 0}.special_email_field{display:none}label{display:block}label.check_box{display:inline}.field_with_errors{display:inline}.error_messages{width:400px;border:2px solid #cf0000;padding:0px;padding-bottom:12px;margin:20px 0;background-color:#f0f0f0;font-size:12px}.error_messages h2{text-align:left;font-weight:bold;padding:5px 10px;font-size:12px;margin:0;background-color:#c00;color:#fff}.error_messages p{margin:8px 10px}.error_messages ul{margin:0;margin-left:10px}#top{position:relative;padding-top:1px}#top .logo{margin-top:50px;margin-left:100px;padding-bottom:10px}#top .user_nav{color:#777;font-size:12px;position:absolute;top:15px;right:100px}#top .user_nav a{color:#777;text-decoration:underline}.warning,.warning a,#top .user_nav .warning a{color:#D00;font-weight:bold}#top .subscribe{position:absolute;bottom:10px;right:100px}#top .subscribe li{position:relative;margin-left:8px;font-size:12px}#top .subscribe li .name{display:none}#top .subscribe li:hover .name{display:block;position:absolute;top:-22px;left:-84px;width:200px;color:#000;text-align:center}#nav_bar{position:relative;padding:8px 100px;background-color:#333;border-top:solid 1px #fff;background:-webkit-gradient(linear, left top, left bottom, from(#5c5c5c), to(#111));background:-moz-linear-gradient(top, #5c5c5c, #111);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#5C5C5C', endColorstr='#111111');border-bottom:solid 3px #de9f00;margin-bottom:15px}#nav_bar .nav{float:right;padding-top:2px}#nav_bar .nav li{padding-left:25px;font-size:14px;color:#BBB}#nav_bar .nav li a{color:#FFF}#main{padding-top:15px;max-width:1500px}#footer{clear:both;font-size:11px;text-align:center;padding:25px 0;color:#555}.content{margin:0 100px;position:relative}.content>h1{margin-top:1px}.text_content{margin:0 100px;margin-right:400px}.actions{margin:8px 0}.actions a{padding:3px 8px 2px 8px;font-size:12px;color:#000;border:1px solid #999;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;background:#DDD;background:-webkit-gradient(linear, left top, left bottom, from(#f5f5f5), to(#ddd));background:-moz-linear-gradient(top, #f5f5f5, #ddd);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#F5F5F5', endColorstr='#DDDDDD');text-decoration:none}.pretty_button{font-size:13px;padding:5px 10px 6px 10px;font-weight:bold;border:1px solid #466a98;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;color:#FFF;background:#386FB2;background:-webkit-gradient(linear, left top, left bottom, from(#67b0ef), to(#2b5ea4));background:-moz-linear-gradient(top, #67b0ef, #2b5ea4);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#67B0EF', endColorstr='#2B5EA4');text-decoration:none;text-shadow:0 -1px 0 #036}.pretty_button:hover{text-decoration:none}.read_button{font-size:13px;padding:5px 10px 6px 10px;font-weight:bold;border:1px solid #6f2c26;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;color:#FFF;background:#A23831;background:-webkit-gradient(linear, left top, left bottom, from(#f98179), to(#a23831));background:-moz-linear-gradient(top, #f98179, #a23831);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#F98179', endColorstr='#A23831');text-decoration:none;text-shadow:0 -1px 0 #661514}.read_button:hover{text-decoration:none}.pagination{margin:8px 0;font-size:12px}.pagination .disabled{color:#999}.pagination em{font-style:normal}.pagination a,.pagination em,.pagination .previous_page,.pagination .next_page{padding:4px}.code_block{margin:12px 0;clear:both}.code_header{position:relative;background-color:#E0E0E0;font-size:12px;padding:4px 7px;border:solid 1px #b6b6b6;border-bottom:none}.CodeRay{overflow:auto;border:1px solid #777;border-top:none;padding:5px 7px;font-size:13px;margin:0;line-height:17px}code{border:solid 1px #ccc;background-color:#EEE;font-family:"Menlo","Courier New","Terminal",monospace;padding:0 3px}pre code{display:block;background-color:#EEE;padding:5px 7px}.episodes{margin-right:200px}.unreleased{color:#D00;font-weight:bold;padding-left:5px}.episodes h2 .remove{font-size:14px;font-weight:normal}.full .episode{padding-bottom:18px;border-bottom:solid 1px #e5e5e5;margin-bottom:20px}.full .screenshot{float:left}.screenshot img{border:solid 1px #999;display:block}.full .main{margin-left:215px}.full .info{color:#999;font-size:12px}.full .info a{color:#999}.full .number{text-transform:uppercase;font-weight:bold}.full h2,.episode h2 a{color:#E98C08}.full h2 .star,.episode h2 a .star{font-size:16px;text-decoration:none;margin-left:3px}.full h2 .unstarred,.episode h2 a .unstarred{color:#AAA}.full h2 .starred,.episode h2 a .starred{color:#E98C08}.full h2{margin:3px 0}.full .description{margin-bottom:17px}.full .stats{font-size:11px;color:#777;font-weight:normal;padding-left:3px}.full .notes{font-size:11px;margin-top:10px}.list{border-collapse:collapse;width:100%}.list .star{font-size:14px;text-decoration:none;margin-left:0}.list .unstarred{color:#AAA}.list .starred{color:#E98C08}.list td,.list th{border-bottom:solid 1px #ccc}.list td{padding:5px}.list th{padding:5px;text-align:left;color:#777}.list .comment_count{color:#000}.list em{color:#777;padding-left:5px}.episodes .grid{margin-right:-30px}.grid .episode{float:left;margin-right:20px;margin-bottom:50px;position:relative}.grid .name{font-size:13px;position:absolute;top:135px;left:0}.grid .name .star{font-size:14px;text-decoration:none;margin-left:0}.grid .name .unstarred{color:#AAA}.grid .name .starred{color:#E98C08}.episodes .filters{margin-bottom:15px}.episodes .filter{border:solid 1px #aaa;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;background-color:#EEE;padding:2px 8px;margin-bottom:10px;margin-right:5px;font-size:12px}.episodes .filter a{padding-left:5px}.side{position:absolute;right:0;top:0}.side .banner{margin-top:15px;text-align:center}.episode_views{padding:0 20px;margin:0;font-weight:normal;color:#444;font-size:12px;text-align:center;border-radius:6px;-webkit-border-radius:6px;-moz-border-radius:6px;border:solid 1px #bbb;background-color:#DDD;background:-webkit-gradient(linear, left top, left bottom, from(#eee), to(#ccc));background:-moz-linear-gradient(top, #eee, #ccc);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#EEEEEE', endColorstr='#CCCCCC');margin-bottom:14px}.episode_views .view{padding-left:3px}.episode_views .view img{background-color:#FFF;background:-webkit-gradient(linear, left top, left bottom, from(#eee), to(#fff));background:-moz-linear-gradient(top, #eee, #fff);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#EEEEEE', endColorstr='#FFFFFF');padding:7px;vertical-align:middle;border:solid 1px #bbb;border-top:none;border-bottom:none}.episode_views .view a img{background:none;padding:2px;border:none}.search_option{margin-bottom:15px}.search_option ul{list-style:none;margin:0;padding:0;border:solid 1px #bbb;border-top:none;padding:5px 20px;border-bottom-left-radius:5px;border-bottom-right-radius:5px;-webkit-border-bottom-left-radius:5px;-webkit-border-bottom-right-radius:5px;-moz-border-radius-bottomleft:5px;-moz-border-radius-bottomright:5px}.search_option li{margin:5px 0;font-size:14px}.search_option h2{padding:4px 20px;margin:0;font-weight:normal;color:#444;font-size:14px;text-align:center;border-top-left-radius:6px;border-top-right-radius:6px;-webkit-border-top-left-radius:6px;-webkit-border-top-right-radius:6px;-moz-border-radius-topleft:6px;-moz-border-radius-topright:6px;border:solid 1px #bbb;border-bottom-color:#AAA;background-color:#DDD;background:-webkit-gradient(linear, left top, left bottom, from(#eee), to(#ccc));background:-moz-linear-gradient(top, #eee, #ccc);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#EEEEEE', endColorstr='#CCCCCC')}#episode{margin:0 auto;width:962px}#episode.legacy{width:802px}#episode #video_wrapper{border:solid 1px #777;margin-bottom:14px}#episode video{display:block}#episode>.info{position:relative;margin-bottom:15px;background-color:#FFF}#episode .info .screenshot{float:left;padding-right:14px}#episode .info h1{margin:0;padding:0;font-size:20px;margin-bottom:3px}#episode .info h1 .star{font-size:16px;text-decoration:none;margin-left:3px}#episode .info h1 .unstarred{color:#AAA}#episode .info h1 .starred{color:#E98C08}#episode .info h1 em{font-size:16px;color:#777;padding-left:5px}#episode .info h1 .position{color:#999}#episode .info .details{color:#777;font-size:12px}#episode .info .watch{padding-bottom:8px}#episode .info .details a{color:#777}#episode .info .description{margin-top:6px;margin-bottom:18px;margin-right:140px}#episode.legacy .info .description{margin-right:0}#episode .info .social{position:absolute;right:-14px;bottom:18px}#episode .info .downloads{position:absolute;bottom:0;right:0;font-size:13px}#episode .info .downloads li{margin-left:8px}#episode .info .downloads li .overlay{font-size:12px;display:none;color:#999;position:absolute;top:-22px;right:110px;width:220px;text-align:right}#episode .info .downloads li:hover .overlay{display:block}#episode .video_info .screenshot,#episode .video_info .description,#episode .video_info .watch{display:none}#episode .nav{padding:0 8px;margin:0;height:35px;font-weight:normal;font-size:14px;text-align:center;border-top-left-radius:6px;border-top-right-radius:6px;-webkit-border-top-left-radius:6px;-webkit-border-top-right-radius:6px;-moz-border-radius-topleft:6px;-moz-border-radius-topright:6px;border:solid 1px #bbb;border-bottom-color:#AAA;background-color:#DDD;background:-webkit-gradient(linear, left top, left bottom, from(#eee), to(#ccc));background:-moz-linear-gradient(top, #eee, #ccc);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#EEEEEE', endColorstr='#CCCCCC')}#episode .nav li{margin:0 6px;margin-top:9px}#episode .nav li a{color:#393939;padding:5px 8px;padding-bottom:10px}#episode .nav li a.selected{border:solid 1px #ccc;border-bottom:none;background-color:#F5F5F5;color:#555;border-top-left-radius:5px;border-top-right-radius:5px;-webkit-border-top-left-radius:5px;-webkit-border-top-right-radius:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px;cursor:default}#episode .nav li a.selected:hover{text-decoration:none}#episode .nav .previous,#episode .nav .next{float:right}#episode .nav_section{background-color:#F5F5F5;border:solid 1px #bbb;border-top:none;padding:10px 20px;position:relative}#episode .nav_section .progress{z-index:100;position:absolute;top:40px;left:400px;background-color:#333;background-color:rgba(0,0,0,0.7);border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;padding:50px}#episode.legacy .nav_section .progress{left:320px}#episode.legacy .asciicast .imageWrapper{overflow:auto;clear:both}#episode.legacy .asciicast .imageWrapper img{display:block}#episode .asciicast .languages{float:right;margin-left:10px}#episode .asciicast{line-height:130%}#episode .browse_code img{vertical-align:bottom}#episode .show_notes ul{margin-top:-10px;padding-top:0;margin-bottom:20px}#episode .episode_actions{float:right;margin-left:10px}#episode .similar{margin-top:15px}#episode .similar .episode:last-child{border-bottom:none}#episode .pro_required{width:700px;margin:20px auto}#episode .pro_required img{float:left;padding-top:5px}#episode .pro_details{margin-left:210px;font-size:16px}#episode .pro_details p{margin-bottom:10px}#comments{margin-top:10px}.comment{margin:20px 0;position:relative}.comment .avatar{float:left;border:solid 1px #ccc;color:#FFF;padding:4px}.comment .avatar img{display:block}.comment .user_actions{position:absolute;top:72px}.comment .main{margin-left:83px}.nested_comments{margin-left:83px}.nested_comments .nested_comments .nested_comments .nested_comments{margin-left:0}.comment .headline{padding:5px 14px;font-size:12px;background-color:#DDD;border:solid 1px #bbb;border-bottom:none;border-top-left-radius:5px;border-top-right-radius:5px;-webkit-border-top-left-radius:5px;-webkit-border-top-right-radius:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px;background:-webkit-gradient(linear, left top, left bottom, from(#eee), to(#ccc));background:-moz-linear-gradient(top, #eee, #ccc);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#EEEEEE', endColorstr='#CCCCCC')}.comment .position,.comment .name{font-weight:bold}.comment .created_at{color:#666;padding-left:8px}.comment_content{padding:1px 15px;background-color:#FFF;border:solid 1px #ccc;border-top:none;border-bottom-left-radius:5px;border-bottom-right-radius:5px;-webkit-border-bottom-left-radius:5px;-webkit-border-bottom-right-radius:5px;-moz-border-radius-bottomleft:5px;-moz-border-radius-bottomright:5px}.comment .actions{margin-bottom:12px}.comment blockquote{margin:0;padding-left:10px;border-left:solid 5px #ccc;color:#777}#add_comment{margin-top:30px}.formatting{font-size:12px;margin:8px 0}.markdown_examples{margin-top:5px}.markdown_examples table{border-collapse:collapse}.markdown_examples table td{border:solid 1px #ccc;padding:2px 10px}.markdown_examples .code_block{width:200px}#pro_info{width:800px;margin:0 auto;font-size:14px}#pro_info .intro{font-size:18px;line-height:24px;margin-bottom:30px}#pro_info .intro img{float:left;margin-right:25px;padding-top:5px}#pro_info .exclamation{text-align:center;font-size:16px;font-style:italic}#pro_info .section{border:solid 1px #aaa;-webkit-border-radius:12px;-moz-border-radius:12px;padding:20px 20px;padding-right:100px;margin-bottom:20px}#pro_info .pro_section{background-image:url(/assets/pro_banner-44f426939bcf7c7edd7809ed78ab104b.png);background-repeat:no-repeat;background-position:right top}#pro_info .revised_section{background-image:url(/assets/revised_banner-49663c3776645879bea01c6f7ef45895.png);background-repeat:no-repeat;background-position:right top}#pro_info .section h3{margin:0;font-size:16px;margin-bottom:2px;color:#000;border-radius:8px}#pro_info .pretty_button{width:280px;margin:0 auto;margin-top:20px;display:block;text-align:center;font-size:16px;border-radius:8px;-webkit-border-radius:8px;-moz-border-radius:8px}#pro_info .pretty_button .per_month{display:block;font-size:12px;font-weight:normal;color:#CBDDF2;margin-top:2px}#pro_info h2.bar{padding:4px 20px;margin:0;font-weight:normal;color:#222;font-size:14px;text-align:center;border-top-left-radius:6px;border-top-right-radius:6px;-webkit-border-top-left-radius:6px;-webkit-border-top-right-radius:6px;-moz-border-radius-topleft:6px;-moz-border-radius-topright:6px;border:solid 1px #bbb;border-bottom-color:#AAA;background-color:#DDD;background:-webkit-gradient(linear, left top, left bottom, from(#f3f3f3), to(#bbb));background:-moz-linear-gradient(top, #f3f3f3, #bbb);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#F3F3F3', endColorstr='#BBBBBB')}#pro_info .already_subscribed{text-align:center;margin-top:15px}#pro_info .already_subscribed,#pro_info .already_subscribed a{color:#777;font-size:14px}#pro_info .already_subscribed a{text-decoration:underline}#pro_subscribe{width:800px;margin:0 auto;font-size:14px}#pro_subscribe .intro img{float:left;padding-top:5px;margin-right:25px;margin-bottom:20px}#pro_subscribe .intro h2{font-size:20px;margin-bottom:3px;color:black;margin-top:0}#pro_subscribe .intro{font-size:13px;color:#777;margin-bottom:30px}#pro_subscribe label{float:left;width:200px;text-align:right;padding-right:10px;padding-top:2px}#pro_subscribe .card_types label{padding-top:8px}#pro_subscribe .cvv_icon{vertical-align:bottom;padding-left:10px}#pro_subscribe .optional{font-size:12px;color:#777}#pro_subscribe .button,#pro_subscribe .quantity{margin-left:210px}#pro_subscribe label.error{display:inline;float:none;color:#D00;padding-left:10px;vertical-align:top}#pro_subscribe h1{margin-left:210px;font-size:18px;margin-top:30px;margin-bottom:1px}#pro_subscribe .cancel_button{font-size:12px;padding:4px 10px 4px 10px;font-weight:normal;border:1px solid #98211e;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;color:#FFF;background:#BC372B;background:-webkit-gradient(linear, left top, left bottom, from(#e55750), to(#9d221a));background:-moz-linear-gradient(top, #e55750, #9d221a);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#E55750', endColorstr='#9D221A');text-decoration:none;text-shadow:0 -1px 0 #036}#manage_subscription{width:800px;margin:0 auto}#manage_subscription .intro{font-size:16px;line-height:22px}#manage_subscription .intro img{float:left;padding-top:5px}#manage_subscription .intro p{margin-left:210px;margin-top:0}#manage_subscription h2{margin:0;padding-top:10px;margin-bottom:10px}#payments{border:solid 1px #ccc;border-radius:10px;-webkit-border-radius:10px;-moz-border-radius:10px}#payments .no_payments{font-style:italic;text-align:center;margin:10px 0}#payments .payment{border-bottom:solid 1px #ccc;position:relative;height:40px}#payments .payment:last-child{border-bottom:none}#payments .payment .card_type{position:absolute;left:10px;top:5px}#payments .payment .date{position:absolute;left:80px;top:12px}#payments .payment .transaction_number{position:absolute;left:270px;top:12px}#payments .payment .amount{position:absolute;left:550px;top:12px}#payments .payment .receipt{position:absolute;right:10px;top:12px}#manage_subscription .next_payment{text-align:center;font-weight:bold}#manage_subscription .actions{text-align:center}#subscription_lookup{margin-right:300px}#subscription_lookup label{display:inline}#subscription_lookup input[type=submit]{margin-left:10px}#about{margin-right:300px}#about .ryan{float:right;padding:7px;margin-left:50px;border:solid 1px #ccc;text-align:center;font-weight:bold}#about .ryan img{display:block;padding-bottom:5px}#about h2{margin-top:25px;margin-bottom:8px}#about p{margin:8px 0}#give_back{float:left;margin-right:8px;margin-bottom:5px}#give_back_instructions{font-size:16px;margin-top:20px}#give_back_instructions ol{margin:0;padding:0}#give_back_instructions li{padding:0;margin:30px 28px;margin-right:0}#give_back_instructions li li{padding:0;margin:15px 28px;margin-right:0}#contest{position:relative}#contest h1{font-size:26px;margin-bottom:2px}#contest .faqs{margin-right:300px}#contest .prizes h3{font-size:14px;margin-bottom:3px;margin-top:20px}#contest .prizes ul{margin:0}#contest .tagline{color:#777;font-size:18px;font-weight:bold}#contest .prize_selection{float:right;margin-left:40px;margin-bottom:30px}#contest .intro{font-size:18px;margin-right:350px}#contest .sponsors{text-align:center;position:absolute;top:270px;right:20px}#contest .sponsors h2{font-size:20px;color:#555}#contest .sponsor{margin:15px 0}#announcement_banner{padding:5px 0;text-align:center;color:#000;background-color:#FFF7E0;border-top:solid 2px #de9f00;border-bottom:solid 2px #de9f00;margin:10px 0}#announcement_banner p{margin:5px 0}#announcement{margin-right:300px}#feedback{width:680px;float:left}#feedback_instructions{margin-left:700px;min-width:225px}#feedback_instructions li{margin:5px 0}#feedback h2.bar{padding:4px 20px;margin:0;font-weight:normal;color:#333;font-size:14px;text-align:center;border-top-left-radius:6px;border-top-right-radius:6px;-webkit-border-top-left-radius:6px;-webkit-border-top-right-radius:6px;-moz-border-radius-topleft:6px;-moz-border-radius-topright:6px;border:solid 1px #bbb;border-bottom-color:#AAA;background-color:#DDD;background:-webkit-gradient(linear, left top, left bottom, from(#f3f3f3), to(#bbb));background:-moz-linear-gradient(top, #f3f3f3, #bbb);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#F3F3F3', endColorstr='#BBBBBB')}#feedback form{background-color:#EEE;padding:10px 20px;border:solid 1px #bbb;border-top:none;border-bottom-left-radius:5px;border-bottom-right-radius:5px;-webkit-border-bottom-left-radius:5px;-webkit-border-bottom-right-radius:5px;-moz-border-radius-bottomleft:5px;-moz-border-radius-bottomright:5px}#feedback .info{font-size:13px;margin-bottom:30px}#feedback label{float:left;width:160px;text-align:right;padding-right:10px;padding-top:2px}#feedback .actions{padding-left:170px}#feedback input,#feedback textarea{font-size:14px}.CodeRay,.CodeRay pre{font-family:"Menlo","Courier New","Terminal",monospace;background-color:#232323;color:#E6E0DB}.CodeRay pre{margin:0px;padding:0px}.CodeRay .an{color:#e7be69}.CodeRay .c{color:#BC9358;font-style:italic}.CodeRay .ch{color:#509e4f}.CodeRay .cl{color:#fff}.CodeRay .co{color:#fff}.CodeRay .fl{color:#a4c260}.CodeRay .fu{color:#ffc56d}.CodeRay .gv{color:#d0cffe}.CodeRay .i{color:#a4c260}.CodeRay .il{background:#151515}.CodeRay .iv{color:#d0cffe}.CodeRay .pp{color:#e7be69}.CodeRay .r{color:#cb7832}.CodeRay .kw{color:#cb7832}.CodeRay .rx{color:#a4c260}.CodeRay .s{color:#a4c260}.CodeRay .sy{color:#6c9cbd}.CodeRay .ta{color:#e7be69}.CodeRay .pc{color:#6c9cbd}#feeds_list{border-collapse:collapse}#feeds_list td{border:1px solid #999;padding:4px 8px}#notifications{width:680px}#notifications form{background-color:#EEE;padding:10px 20px;border:solid 1px #bbb;border-radius:5px;border-radius:5px;-webkit-border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-moz-border-radius:5px}#notifications .info{font-size:13px;margin-bottom:30px}#notifications label{float:left;width:160px;text-align:right;padding-right:10px;padding-top:2px}#notifications input[type=checkbox]{margin-left:170px}#notifications .check_box label{float:none;width:auto;text-align:left;padding:0;display:inline}#notifications .actions{padding-left:170px}
  </style>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>
   #405 AngularJS (pro) - RailsCasts
  </title>
  <meta content="Short Ruby on Rails screencasts containing tips, tricks and tutorials. Great for both novice and experienced web developers." name="description">
  <meta content="rails, ruby on rails, screencasts, railscast, railscasts, tips, tricks, tutorials, training, podcasts, programming" name="keywords">
  <meta content="authenticity_token" name="csrf-param">
  <meta content="M2bsLb5uXBIafpdDdn3PbhJVjPywoWKr+Tjt9wIJ2Jo=" name="csrf-token">
 </head>
 <body>
  <div id="top">
   <div class="logo">
    <a>
     <img alt="RailsCasts - Ruby on Rails Screencasts" height="56" src="rick.jpg" width="423">
    </a>
   </div>
   <div class="user_nav">
   </div>
   <ul class="subscribe horizontal">
    <li>
     <a>
      <img alt="Itunes" height="34" src="rick.jpg" width="34">
     </a>
     <span class="name">
      watch on iTunes
     </span>
    </li>
    <li>
     <a>
      <img alt="Twitter" height="34" src="rick.jpg" width="34">
     </a>
     <span class="name">
      follow on Twitter
     </span>
    </li>
    <li>
     <a>
      <img alt="Facebook" height="34" src="rick.jpg" width="34">
     </a>
     <span class="name">
      follow on Facebook
     </span>
    </li>
    <li>
     <a>
      <img alt="Rss" height="34" src="rick.jpg" width="34">
     </a>
     <span class="name">
      subscribe to RSS feed
     </span>
    </li>
   </ul>
  </div>
  <div id="nav_bar">
   <ul class="nav horizontal">
    <li>
     <a>
      Browse Episodes
     </a>
    </li>
    <li>
     <a>
      RailsCasts Pro
     </a>
    </li>
    <li>
     <a>
      Notifications
     </a>
    </li>
    <li>
     <a>
      About
     </a>
    </li>
   </ul>
   <form accept-charset="UTF-8" action="http://railscasts.com/episodes" method="get">
    <div style="margin:0;padding:0;display:inline">
     <input name="utf8" type="hidden" value="&checkmark;">
    </div>
    <input id="search" name="search" size="35" type="text">
    <input type="submit" value="Search Episodes">
   </form>
  </div>
  <div id="announcement_banner">
   <p>
    RailsCasts Pro episodes are now free!
   </p>
   <p>
    <a>
     Learn more
    </a>
    or
    <a data-remote="true">
     hide this
    </a>
   </p>
  </div>
  <div id="main">
   <div id="episode">
    <div class="info">
     <div class="screenshot">
      <a class="play_video">
       <img alt="AngularJS" height="125" src="rick.jpg" width="200">
      </a>
     </div>
     <h1>
      <span class="position">
       #405
      </span>
      AngularJS
      <em>
       pro
      </em>
     </h1>
     <div class="details">
      Feb 05, 2013 | 16 minutes |
      <a>
       Ajax
      </a>
      ,
      <a>
       Plugins
      </a>
      ,
      <a>
       APIs
      </a>
     </div>
     <div class="description">
      AngularJS is an awesome framework for easily creating rich, client-side applications. Its powerful bindings allow you to do a lot with very little code.
     </div>
     <div class="watch">
      <a class="play_video pretty_button">
       Click to Play Video â–¶
      </a>
     </div>
     <div class="social">
      <a class="twitter-share-button" data-count="horizontal" data-text="Watching AngularJS on RailsCasts" data-twitter-extracted-i1698624858169535717="true" data-url="http://railscasts.com/episodes/405-angularjs" data-via="railscasts">
       Tweet
      </a>
     </div>
     <ul class="downloads horizontal">
      <li>
       Download:
      </li>
      <li>
       <a>
        source code
       </a>
       <span class="overlay">
        Project Files in Zip (35.4 KB)
       </span>
      </li>
      <li>
       <a>
        mp4
       </a>
       <span class="overlay">
        Full Size H.264 Video (33.3 MB)
       </span>
      </li>
      <li>
       <a>
        m4v
       </a>
       <span class="overlay">
        Smaller H.264 Video (17.9 MB)
       </span>
      </li>
      <li>
       <a>
        webm
       </a>
       <span class="overlay">
        Full Size VP8 Video (22.8 MB)
       </span>
      </li>
      <li>
       <a>
        ogv
       </a>
       <span class="overlay">
        Full Size Theora Video (40.1 MB)
       </span>
      </li>
     </ul>
     <div class="clear">
     </div>
    </div>
    <ul class="nav horizontal">
     <li class="selected">
      <a class="tab">
       Show Notes
      </a>
     </li>
     <li>
      <a class="selected tab">
       ASCIIcast
      </a>
     </li>
     <li>
      <a class="tab">
       243 Comments
      </a>
     </li>
     <li>
      <a class="tab">
       Similar Episodes
      </a>
     </li>
     <li class="next">
      <a>
       Next Episode &gt;
      </a>
     </li>
     <li class="previous">
      <a>
       &lt; Previous Episode
      </a>
     </li>
    </ul>
    <div class="nav_section">
     <div class="inner">
      <div class="asciicast">
       <div class="languages">
        <a>
         <img alt="Ko" height="32" src="rick.jpg" width="32">
        </a>
       </div>
       <p>
        <a>
         AngularJS
        </a>
        is a framework for creating rich client-side applications. In this episode we&rsquo;ll demonstrate some of what it can do and how to integrate it into a Rails application. The application we&rsquo;ll build will be a simple raffling app where we can enter names and draw random winners. We used a similar app for demonstrating Backbone and Meteor in previous episodes so this will provide a good comparison. We&rsquo;ll start by creating a Rails application with a
        <code>
         RaffleController
        </code>
        with an
        <code>
         index
        </code>
        action. We&rsquo;ll also remove the default static index page.
       </p>
       <div class="code_block">
        <div class="code_header">
         terminal
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>$ rails new raffler
$ cd raffler
$ rails g controller raffle index
$ rm public/index.html</pre>
         </div>
        </div>
       </div>
       <p>
        Next we&rsquo;ll set this action up as the root action.
       </p>
       <div class="code_block">
        <div class="code_header">
         /config/routes.rb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="co">Raffler</span>::<span class="co">Application</span>.routes.draw <span class="r">do</span>
  root <span class="sy">to:</span> <span class="s"><span class="dl">"</span><span class="k">raffle#index</span><span class="dl">"</span></span>
<span class="r">end</span></pre>
         </div>
        </div>
       </div>
       <p>
        We already have some CSS written for this application so we&rsquo;ll add that to the
        <code>
         raffle.css.scss
        </code>
        file. We&rsquo;ll also wrap the call to
        <code>
         yield
        </code>
        in the layout file in a
        <code>
         div
        </code>
        so that we can reference it from our stylesheets.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/views/layouts/application.html.erb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="dt">&lt;!DOCTYPE html&gt;</span>
<span class="ta">&lt;html&gt;</span>
<span class="ta">&lt;head&gt;</span>
  <span class="ta">&lt;title&gt;</span>Raffler<span class="ta">&lt;/title&gt;</span>
  <span class="il"><span class="idl">&lt;%=</span> stylesheet_link_tag    <span class="s"><span class="dl">"</span><span class="k">application</span><span class="dl">"</span></span>, <span class="sy">:media</span> =&gt; <span class="s"><span class="dl">"</span><span class="k">all</span><span class="dl">"</span></span> <span class="idl">%&gt;</span></span>
  <span class="il"><span class="idl">&lt;%=</span> javascript_include_tag <span class="s"><span class="dl">"</span><span class="k">application</span><span class="dl">"</span></span> <span class="idl">%&gt;</span></span>
  <span class="il"><span class="idl">&lt;%=</span> csrf_meta_tags <span class="idl">%&gt;</span></span>
<span class="ta">&lt;/head&gt;</span>
<span class="ta">&lt;body&gt;</span>

<span class="ta">&lt;div</span> <span class="an">id</span>=<span class="s"><span class="dl">"</span><span class="k">container</span><span class="dl">"</span></span><span class="ta">&gt;</span>
  <span class="il"><span class="idl">&lt;%=</span> <span class="r">yield</span> <span class="idl">%&gt;</span></span>
<span class="ta">&lt;/div&gt;</span>

<span class="ta">&lt;/body&gt;</span>
<span class="ta">&lt;/html&gt;</span></pre>
         </div>
        </div>
       </div>
       <p>
        We now have a single-page application, although it doesn&rsquo;t do anything. Let&rsquo;s add AngularJS to it. There are several ways that we can do this: one is to download the relevant files from the AngularJS website and add them to our application&rsquo;s
        <code>
         /vendor
        </code>
        directory. Alternatively we can use a gem and we&rsquo;ll add one called
        <code>
         angularjs-rails
        </code>
        to the assets group of our gemfile. As ever we need to run
        <code>
         bundle
        </code>
        to install it.
       </p>
       <div class="code_block">
        <div class="code_header">
         /Gemfile
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>group <span class="sy">:assets</span> <span class="r">do</span>
  gem <span class="s"><span class="dl">'</span><span class="k">sass-rails</span><span class="dl">'</span></span>,   <span class="s"><span class="dl">'</span><span class="k">~&gt; 3.2.3</span><span class="dl">'</span></span>
  gem <span class="s"><span class="dl">'</span><span class="k">coffee-rails</span><span class="dl">'</span></span>, <span class="s"><span class="dl">'</span><span class="k">~&gt; 3.2.1</span><span class="dl">'</span></span>

  <span class="c"># See https://github.com/sstephenson/execjs#readme for more supported runtimes</span>
  <span class="c"># gem 'therubyracer', :platforms =&gt; :ruby</span>

  gem <span class="s"><span class="dl">'</span><span class="k">uglifier</span><span class="dl">'</span></span>, <span class="s"><span class="dl">'</span><span class="k">&gt;= 1.0.3</span><span class="dl">'</span></span>
  gem <span class="s"><span class="dl">'</span><span class="k">angularjs-rails</span><span class="dl">'</span></span>
<span class="r">end</span></pre>
         </div>
        </div>
       </div>
       <p>
        We&rsquo;ll use the assets that this gem provides in the JavaScript manifest file.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/application.js
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="c">//= require angular</span>
<span class="c">//= require_tree .</span></pre>
         </div>
        </div>
       </div>
       <p>
        AngularJS is compatible with jQuery but it isn&rsquo;t required. We&rsquo;ve removed it from the manifest file so that we&rsquo;re not tempted to fall back on to jQuery code while we&rsquo;re learning Angular.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/views/layouts/application.html.erb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="ta">&lt;html</span> <span class="an">ng-app</span><span class="ta">&gt;</span></pre>
         </div>
        </div>
       </div>
       <p>
        We can now start to use Angular in our
        <code>
         index
        </code>
        template. At the top of this page we want a form where the user can add a name to go into the raffle so we&rsquo;ll give it a text field. One of the cool features of Angular that we can use here is its two-way binding. We can bind a form field to some model data by adding an
        <code>
         ng-model
        </code>
        attribute whose value is a name.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/views/raffle/index.html.erb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="ta">&lt;h1&gt;</span>Raffler<span class="ta">&lt;/h1&gt;</span>

<span class="ta">&lt;form&gt;</span>
  <span class="ta">&lt;input</span> <span class="an">type</span>=<span class="s"><span class="dl">"</span><span class="k">text</span><span class="dl">"</span></span> <span class="an">ng-model</span>=<span class="s"><span class="dl">"</span><span class="k">newEntry.name</span><span class="dl">"</span></span><span class="ta">&gt;</span>
<span class="ta">&lt;/form&gt;</span> 

{{newEntry.name}}</pre>
         </div>
        </div>
       </div>
       <p>
        We&rsquo;ve used
        <code>
         newEntry.name
        </code>
        here. One way to think of this is that
        <code>
         newEntry
        </code>
        is the object we&rsquo;re working with in this form and
        <code>
         name
        </code>
        is the attribute that we&rsquo;re managing through this text field. To see this binding in effect we display its value which we do by using double curly brackets. We&rsquo;ll start up our application and load its home page now to try it out. As we start typing in the text box the value is instantly bound and what we&rsquo;ve typed is repeated where we display the value.
       </p>
       <div class="imageWrapper">
        <img alt="Any text we type into the textbox is immediately reflected below." height="400" src="rick.jpg" width="800">
       </div>
       <p>
        Next we want to add a list of the existing entries below the text box. When we submit the form the new entry should be appended to this list. We can only get so far with simple bindings and to add custom behaviour we can add some JavaScript using a controller. Adding a controller is commonly done by using a
        <code>
         div
        </code>
        tag with an
        <code>
         ng-controller
        </code>
        attribute a nd a name ending in
        <code>
         Ctrl
        </code>
        .
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/views/raffle/index.html.erb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="ta">&lt;h1&gt;</span>Raffler<span class="ta">&lt;/h1&gt;</span>

<span class="ta">&lt;div</span> <span class="an">ng-controller</span>=<span class="s"><span class="dl">"</span><span class="k">RaffleCtrl</span><span class="dl">"</span></span><span class="ta">&gt;</span>
<span class="ta">&lt;form&gt;</span>
  <span class="ta">&lt;input</span> <span class="an">type</span>=<span class="s"><span class="dl">"</span><span class="k">text</span><span class="dl">"</span></span> <span class="an">ng-model</span>=<span class="s"><span class="dl">"</span><span class="k">newEntry.name</span><span class="dl">"</span></span><span class="ta">&gt;</span>
<span class="ta">&lt;/form&gt;</span> 

{{newEntry.name}}
<span class="ta">&lt;/div&gt;</span></pre>
         </div>
        </div>
       </div>
       <p>
        We&rsquo;ll write this controller in the
        <code>
         raffle
        </code>
        CoffeeScript file. This can be a simple function but in order for it be accessible we&rsquo;ll use the
        <code>
         @
        </code>
        symbol so that AngularJS can see it.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>@RaffleCtrl = ($scope) -&gt;
  $scope.entries = [
    {name: "Larry"}
    {name: "Curly"}
    {name: "Moe"}
  ]</pre>
         </div>
        </div>
       </div>
       <p>
        This function takes a scope, which is an object that allows us to interact with a view.  We can get and set variables and functions on this scope and we&rsquo;ve set an
        <code>
         entries
        </code>
        variable and set it to an array of entries for the raffle. In our view template we want to render this data as a list which we do like this:
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/views/raffle/index.html.erb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="ta">&lt;ul&gt;</span>
  <span class="ta">&lt;li</span> <span class="an">ng-repeat</span>=<span class="s"><span class="dl">"</span><span class="k">entry in entries</span><span class="dl">"</span></span><span class="ta">&gt;</span>
    {{entry.name}}
  <span class="ta">&lt;/li&gt;</span>
<span class="ta">&lt;/ul&gt;</span></pre>
         </div>
        </div>
       </div>
       <p>
        We now have an unordered list and we want to display each item in the collection in it. We&rsquo;ve done this by adding an
        <code>
         ng-repeat
        </code>
        attribute to its
        <code>
         li
        </code>
        element and giving it a value of
        <code>
         entry in entries
        </code>
        . This loops through our
        <code>
         entries
        </code>
        array and repeats the element for each one and display its
        <code>
         name
        </code>
        . When we reload the page we&rsquo;ll see the list of entries that we entered.
       </p>
       <div class="imageWrapper">
        <img alt="Our entries are now shown in a list." height="400" src="rick.jpg" width="800">
       </div>
       <p>
        Next we&rsquo;ll make changes so that when a new entry is entered in the text box and the form is submitted it&rsquo;s added to the list. We&rsquo;ll add a button to the form and hook into the submit event by adding an
        <code>
         ng-submit
        </code>
        attribute to the form. This will trigger a function on the scope that we&rsquo;ll call
        <code>
         addEntry
        </code>
        .
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/views/raffle/index.html.erb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="ta">&lt;form</span> <span class="an">ng-submit</span>=<span class="s"><span class="dl">"</span><span class="k">addEntry()</span><span class="dl">"</span></span><span class="ta">&gt;</span>
  <span class="ta">&lt;input</span> <span class="an">type</span>=<span class="s"><span class="dl">"</span><span class="k">text</span><span class="dl">"</span></span> <span class="an">ng-model</span>=<span class="s"><span class="dl">"</span><span class="k">newEntry.name</span><span class="dl">"</span></span><span class="ta">&gt;</span>
  <span class="ta">&lt;input</span> <span class="an">type</span>=<span class="s"><span class="dl">"</span><span class="k">submit</span><span class="dl">"</span></span> <span class="an">value</span>=<span class="s"><span class="dl">"</span><span class="k">Add</span><span class="dl">"</span></span><span class="ta">&gt;</span>
<span class="ta">&lt;/form&gt;</span></pre>
         </div>
        </div>
       </div>
       <p>
        We&rsquo;ll write this function in our CoffeeScript file. In it we just need to push the new entry to the array using
        <code>
         $scope.newEntry
        </code>
        which is the object that the form creates. We then set this to an empty object to clear the text box.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>$scope.addEntry = -&gt;
  $scope.entries.push($scope.newEntry)
  $scope.newEntry = {}</pre>
         </div>
        </div>
       </div>
       <p>
        When we reload the page now the button is there and when we type an entry and submit the form it&rsquo;s added to the list without a page reload.
       </p>
       <div class="imageWrapper">
        <img alt="Adding an entry now appends it to the list." height="450" src="rick.jpg" width="800">
       </div>
       <p>
        This shows how powerful Angular&rsquo;s bindings are. With them we can change the data in the JavaScript and see that change instantly reflected in the view.
       </p>
       <h3>
        Drawing Winners
       </h3>
       <p>
        Next we&rsquo;ll add a &ldquo;Draw Winner&rdquo; button below the list which will select a random entry and mark it as a winner. First we&rsquo;ll add the button in the view below the list. To listen to its
        <code>
         click
        </code>
        event we use an
        <code>
         ng-click
        </code>
        attribute with a function.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/views/raffle/index.html.erb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="ta">&lt;button</span> <span class="an">ng-click</span>=<span class="s"><span class="dl">"</span><span class="k">drawWinner()</span><span class="dl">"</span></span><span class="ta">&gt;</span>Draw Winner<span class="ta">&lt;/button&gt;</span></pre>
         </div>
        </div>
       </div>
       <p>
        We&rsquo;ll write that function now. In it we pick a random entry and set its
        <code>
         winner
        </code>
        property to
        <code>
         true
        </code>
        .
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>$scope.drawWinner = -&gt;
  entry = $scope.entries[Math.floor(Math.random() * $scope.entries.length)]
  entry.winner = true</pre>
         </div>
        </div>
       </div>
       <p>
        In the view we&rsquo;ll add some code to show winning users as winners.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/views/raffle/index.html.erb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="ta">&lt;li</span> <span class="an">ng-repeat</span>=<span class="s"><span class="dl">"</span><span class="k">entry in entries</span><span class="dl">"</span></span><span class="ta">&gt;</span>
  {{entry.name}}
  <span class="ta">&lt;span</span> <span class="an">ng-show</span>=<span class="s"><span class="dl">"</span><span class="k">entry.winner</span><span class="dl">"</span></span> <span class="an">class</span>=<span class="s"><span class="dl">"</span><span class="k">winner</span><span class="dl">"</span></span><span class="ta">&gt;</span>WINNER<span class="ta">&lt;/span&gt;</span>
<span class="ta">&lt;/li&gt;</span></pre>
         </div>
        </div>
       </div>
       <p>
        Here we use the
        <code>
         ng-show
        </code>
        attribute which only displays the element it&rsquo;s attached to if its value returns
        <code>
         true
        </code>
        . If we reload the page now then click &ldquo;Draw Winner&rdquo; a random entrant should be marked as a winner.
       </p>
       <div class="imageWrapper">
        <img alt="We can now draw winners from the entrants." height="500" src="rick.jpg" width="800">
       </div>
       <p>
        We can select multiple winners and we&rsquo;d like the most recently-selected winner to be displayed in red. To do this we&rsquo;ll need to keep track of the most-recent winner so we&rsquo;ll create a
        <code>
         lastWinner
        </code>
        variable in our scope.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre> $scope.drawWinner = -&gt;
  entry = $scope.entries[Math.floor(Math.random() * $scope.entries.length)]
  entry.winner = true
  $scope.lastWinner = entry</pre>
         </div>
        </div>
       </div>
       <p>
        Now we&rsquo;ll add a class to the
        <code>
         span
        </code>
        tag for the last winner. We use the
        <code>
         ng-class
        </code>
        attribute for this and give it an expression with single curly braces so that the
        <code>
         highlight
        </code>
        class is added if the entry is the last winner.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/views/raffle/index.html.erb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="ta">&lt;li</span> <span class="an">ng-repeat</span>=<span class="s"><span class="dl">"</span><span class="k">entry in entries</span><span class="dl">"</span></span><span class="ta">&gt;</span>
  {{entry.name}}
  <span class="ta">&lt;span</span> <span class="an">ng-show</span>=<span class="s"><span class="dl">"</span><span class="k">entry.winner</span><span class="dl">"</span></span> <span class="an">ng-class</span>=<span class="s"><span class="dl">"</span><span class="k">{highlight: entry == lastWinner}</span><span class="dl">"</span></span> <span class="an">class</span>=<span class="s"><span class="dl">"</span><span class="k">winner</span><span class="dl">"</span></span><span class="ta">&gt;</span>WINNER<span class="ta">&lt;/span&gt;</span>
<span class="ta">&lt;/li&gt;</span></pre>
         </div>
        </div>
       </div>
       <p>
        When we reload the page now and click the &ldquo;Draw Winner&rdquo; button a couple of times we&rsquo;ll see that the most recent winner is shown red just like we want.
       </p>
       <div class="imageWrapper">
        <img alt="The most recent winner is now shown in red." height="500" src="rick.jpg" width="800">
       </div>
       <p>
        The next thing we want to do is change the behaviour of the &ldquo;Draw Winner&rdquo; button so that it doesn&rsquo;t re-select a current winner, which it currently does. We want to choose only from the entrants who have yet to win so we&rsquo;ll create a pool of the entrants who haven&rsquo;t yet won and choose a winner from those.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>$scope.drawWinner = -&gt;
  pool = []
  angular.forEach $scope.entries, (entry) -&gt;
    pool.push(entry) if !entry.winner
  if pool.length &gt; 0
    entry = pool[Math.floor(Math.random() * pool.length)]
    entry.winner = true
    $scope.lastWinner = entry</pre>
         </div>
        </div>
       </div>
       <p>
        We do this by using Angular&rsquo;s
        <code>
         forEach
        </code>
        to loop through the entries and adding the ones what haven&rsquo;t won to the pool. We then select our winners from this pool.
       </p>
       <h3>
        Persisting Changes to The Database
       </h3>
       <p>
        We&rsquo;re pretty much done with the client-side behaviour of our application but any entrants we add or winners we pick are reset when we reload the page and aren&rsquo;t persisted to the database. We&rsquo;ll modify our app so that it communicates with the Rails back end and persists the changes we make to the database. We&rsquo;ll generate an
        <code>
         Entry
        </code>
        resource with name and winner attributes then migrate the database.
       </p>
       <div class="code_block">
        <div class="code_header">
         terminal
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>$ rails g resource entry name winner:boolean
$ rake db:migrate</pre>
         </div>
        </div>
       </div>
       <p>
        We want some initial data to work with so we&rsquo;ll create some entries in the seeds file. We can then run
        <code>
         rake db:seed
        </code>
        to add them to the database.
       </p>
       <div class="code_block">
        <div class="code_header">
         /db/seeds.rb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="co">Entry</span>.create!(<span class="sy">name:</span> <span class="s"><span class="dl">"</span><span class="k">Matz</span><span class="dl">"</span></span>)
<span class="co">Entry</span>.create!(<span class="sy">name:</span> <span class="s"><span class="dl">"</span><span class="k">DHH</span><span class="dl">"</span></span>)
<span class="co">Entry</span>.create!(<span class="sy">name:</span> <span class="s"><span class="dl">"</span><span class="k">Jose Valim</span><span class="dl">"</span></span>)
<span class="co">Entry</span>.create!(<span class="sy">name:</span> <span class="s"><span class="dl">"</span><span class="k">Avdi Grimm</span><span class="dl">"</span></span>)
<span class="co">Entry</span>.create!(<span class="sy">name:</span> <span class="s"><span class="dl">"</span><span class="k">Steve Klabnik</span><span class="dl">"</span></span>)
<span class="co">Entry</span>.create!(<span class="sy">name:</span> <span class="s"><span class="dl">"</span><span class="k">Aaron Patterson</span><span class="dl">"</span></span>)</pre>
         </div>
        </div>
       </div>
       <p>
        We need to make a JSON API for this data so that we can communicate with AngularJS and we&rsquo;ll write this in the
        <code>
         EntriesController
        </code>
        .
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/controllers/entries_controller.rb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="r">class</span> <span class="cl">EntriesController</span> &amp;lt; <span class="co">ApplicationController</span>
  respond_to <span class="sy">:json</span>

  <span class="r">def</span> <span class="fu">index</span>
    respond_with <span class="co">Entry</span>.all
  <span class="r">end</span>

  <span class="r">def</span> <span class="fu">show</span>
    respond_with <span class="co">Entry</span>.find(params[<span class="sy">:id</span>])
  <span class="r">end</span>

  <span class="r">def</span> <span class="fu">create</span>
    respond_with <span class="co">Entry</span>.create(params[<span class="sy">:entry</span>])
  <span class="r">end</span>

  <span class="r">def</span> <span class="fu">update</span>
    respond_with <span class="co">Entry</span>.update(params[<span class="sy">:id</span>], params[<span class="sy">:entry</span>])
  <span class="r">end</span>

  <span class="r">def</span> <span class="fu">destroy</span>
    respond_with <span class="co">Entry</span>.destroy(params[<span class="sy">:id</span>])
  <span class="r">end</span>
<span class="r">end</span></pre>
         </div>
        </div>
       </div>
       <p>
        The code for this is fairly simple. We use
        <code>
         respond_to :json
        </code>
        and respond in each each action. You&rsquo;ll probably want to be more extensive in how you set up this API but our simple approach will work here. To communicate with the API we can use something called Angular Resource which is provided as a separate JavaScript file and which we&rsquo;ll need to include in our app&rsquo;s JavaScript manifest file.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/application.js
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre><span class="c">//= require angular</span>
<span class="c">//= require angular-resource</span>
<span class="c">//= require_tree .</span></pre>
         </div>
        </div>
       </div>
       <p>
        To use this in our application we&rsquo;ll need to restructure the CoffeeScript code a little. We need to define the resource as a dependency and to do this we&rsquo;ll need to make a module which we do by calling
        <code>
         angular.module
        </code>
        and giving it a name. We need to define
        <code>
         ngResource
        </code>
        as a dependency for this module to allow us to take advantage of the new file that we included and we&rsquo;ll store the result of this in a variable. Now that we have our Angular Resource dependency set up we can pass the resource as an argument to our controller. This is a function that we can call to return an object that allows us to communicate over a REST API. The first argument passed to this function is the URL to the API and we use
        <code>
         /entries/:id
        </code>
        here which makes
        <code>
         :id
        </code>
        a parameter. The second argument specifies the default parameters and we&rsquo;ll set the
        <code>
         id
        </code>
        to the
        <code>
         @id
        </code>
        which will be the current object&rsquo;s
        <code>
         id
        </code>
        . If we&rsquo;re passing an Entry object in to here which has an id assigned then this will be used in the URL otherwise it&rsquo;s skipped and
        <code>
         /entries
        </code>
        is used. The third argument allows us to specify additional actions that we want to call on the API. The default values handle most of what we need except for the update action so we&rsquo;ll add this and set its method to PUT.
       </p>
       <p>
        If you want to learn more about how Angular Resource works
        <a>
         take a look at the documentation
        </a>
        which describes the arguments that we supplied and which shows the default actions which are
        <code>
         get
        </code>
        ,
        <code>
         save
        </code>
        ,
        <code>
         query
        </code>
        ,
        <code>
         remove
        </code>
        and
        <code>
         delete
        </code>
        . We can trigger each of these actions as functions so we&rsquo;ll replace the static list of entries in our code with a call to
        <code>
         Entry.query()
        </code>
        which will call our API that will fetch all the entries from the database.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>app = angular.module("Raffler", ["ngResource"])

@RaffleCtrl = ($scope, $resource) -&gt;
  Entry = $resource("/entries/:id", {id: "@id"}, {update: {method: "PUT"}})
  $scope.entries = Entry.query()</pre>
         </div>
        </div>
       </div>
       <p>
        Since we&rsquo;ve given our application a module name we&rsquo;ll need to set this as the name in our layout file which we do by setting a value on the
        <code>
         ng-app
        </code>
        attribute.
       </p>
       /app/views/raffle/index.html.erb
       <div class="code_block">
        <div class="code_header">
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>&lt;div ng-controller="RaffleCtrl"&gt;</pre>
         </div>
        </div>
       </div>
       When we reload the page now we should see the list of names that we added to the database from our seed data.
       <div class="imageWrapper">
        <img alt="The list of entrants now comes from the database." height="600" src="rick.jpg" width="800">
       </div>
       <p>
        When we create an entry we want to save it before we add it to the list. We do this by calling the
        <code>
         Entry.save
        </code>
        function which will submit a POST request and trigger the
        <code>
         create
        </code>
        action in our Rails app.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>$scope.addEntry = -&gt;
  entry = Entry.save($scope.newEntry)
  $scope.entries.push(entry)
  $scope.newEntry = {}</pre>
         </div>
        </div>
       </div>
       <p>
        When we mark an entry as a winner we need to update it in the database and we can do this by either calling
        <code>
         Entry.update
        </code>
        and passing in the entry or alternatively calling
        <code>
         entry.$update
        </code>
        as our entry is already a resource object that we can trigger actions on.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>$scope.drawWinner = -&gt;
  pool = []
  angular.forEach $scope.entries, (entry) -&gt;
    pool.push(entry) if !entry.winner
  if pool.length &gt; 0
    entry = pool[Math.floor(Math.random() * pool.length)]
    entry.winner = true
    entry.$update()
    $scope.lastWinner = entry</pre>
         </div>
        </div>
       </div>
       <p>
        To see if this works we&rsquo;ll reload the page again, add a new entrant and mark some entrants as winners. When we reload the page again the changes should persist.
       </p>
       <div class="imageWrapper">
        <img alt="Any data we add is now persisted back to the database. " height="600" src="rick.jpg" width="800">
       </div>
       <p>
        This has worked. The data has persisted as it was stored in the Rails database.
       </p>
       <h3>
        Services
       </h3>
       <p>
        We want to refactor resources out into services. A service is something that we can pass into our controller (scopes and resources are services). We want to pass the
        <code>
         Entry
        </code>
        resource into our controller instead of creating the resource there. To do this we can call
        <code>
         app.factory
        </code>
        to generate a resource that we&rsquo;ll call &ldquo;Entry&rdquo;.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>app = angular.module("Raffler", ["ngResource"])

app.factory "Entry", ($resource)
  $resource("/entries/:id", {id: "@id"}, {update: {method: "PUT"}} )

@RaffleCtrl = ($scope, Entry) -&gt;
  $scope.entries = Entry.query()
  
  # rest of code omitted.</pre>
         </div>
        </div>
       </div>
       <p>
        It&rsquo;s important to understand what&rsquo;s going on here. Angular does dependency injection which means that it takes a look at the arguments that this function accepts and gives it those services depending on the name of the argument. In this case the Entry argument will be trigger the
        <code>
         Entry
        </code>
        factory function and use whatever it returns. This means that we could even swap the two arguments and our application would still work as the arguments are supplied based on the name that we pass in.
       </p>
       <p>
        This seems convenient but it presents a big problem when we move our application into production. Rails will automatically minify the JavaScript and convert the argument names into something smaller which means that the dependency injection will no longer work.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>@RaffleCtrl = ("$scope", "Entry", $scope, Entry) -&gt;</pre>
         </div>
        </div>
       </div>
       <p>
        This tells AngularJS what the dependencies are so that if the names do change it won&rsquo;t matter. We have to do this for every function that accepts services, for example the one we have for creating resources.
       </p>
       <div class="code_block">
        <div class="code_header">
         /app/assets/javascripts/raffle.js.coffee
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>app.factory "Entry", ["$resource", ($resource)
  $resource("/entries/:id", {id: "@id"}, {update: {method: "PUT"}} )
]</pre>
         </div>
        </div>
       </div>
       <p>
        Another solution is to modify our production environment&rsquo;s configuration file and configure how the compression is done.
       </p>
       <div class="code_block">
        <div class="code_header">
         /config/environments/production.rb
        </div>
        <div class="CodeRay">
         <div class="code">
          <pre>config.assets.js_compressor = <span class="co">Sprockets</span>::<span class="co">LazyCompressor</span>.new { <span class="co">Uglifier</span>.new(<span class="sy">mangle:</span> <span class="pc">false</span>)}</pre>
         </div>
        </div>
       </div>
       <p>
        Doing this means that the names won&rsquo;t be changed, although the minification won&rsquo;t be as effective. Whichever approach you take it&rsquo;s a good idea to thoroughly test your Angular applications in the production environment to make sure that there are no problems when it goes live.
       </p>
       <p>
        Our application is now complete and AngularJS made it very easy to make a dynamic client-side app and it all syncs up nicely with our Rails back end. We&rsquo;ve only scratched the surface of what AngularJS can do in this episode. It has routers, views and much more. The learning section of the size is well worth taking a look at for more details and
        <a>
         the Egghead website
        </a>
        has some free screencasts covering Angular. There are also several other Ruby gems available to help to integrate Angular into your Rails applications, for example
        <a>
         AngularJS Scaffold
        </a>
        .
       </p>
      </div>
     </div>
     <div class="progress" style="display: none">
      <img alt="loading" src="rick.jpg">
     </div>
    </div>
   </div>
  </div>
  <div id="footer">
   <div class="inner">
    &copy;2023 RailsCasts -
    <a>
     Privacy Policy
    </a>
   </div>
  </div>
  <!-- Google Analytics -->
 </body>
</html>
